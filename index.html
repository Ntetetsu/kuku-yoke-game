<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <title>„Çπ„Éö„Éº„Çπ„Ç∑„É•„Éº„Çø„ÉºÔºãÁÆóÊï∞„ÇØ„Ç§„Ç∫</title>
  <style>
    :root {
      --enemy: #ff4757;
      --player: #5352ed;
      --item: #ffa502;
      --bullet: #2ed573;
      --text: #f1f2f6;
      --panel: #2f3542;
      --barrier: #70a1ff;
    }
    html, body {
      height: 100%;
      margin: 0;
      background: #0a0e27;
      color: var(--text);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      display:flex;
      justify-content:center;
      align-items:center;
    }
    #container {
      text-align:center;
    }
    h1 {
      margin: 0 0 16px;
      color: #ffa502;
      font-size: 24px;
      text-shadow: 0 0 10px rgba(255,165,2,0.5);
    }
    canvas {
      background: linear-gradient(180deg, #0a0e27 0%, #1e2a4a 100%);
      border: 3px solid #5352ed;
      border-radius: 12px;
      box-shadow: 0 0 20px rgba(83,82,237,0.4);
    }
    .controls {
      margin-top: 16px;
      display: flex;
      gap: 12px;
      justify-content: center;
      align-items: center;
      flex-wrap: wrap;
    }
    button {
      padding: 10px 20px;
      font-size: 15px;
      border-radius: 8px;
      background: #5352ed;
      color: white;
      border: none;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.2s;
    }
    button:hover {
      background: #3742fa;
      transform: translateY(-2px);
    }
    #info {
      font-size: 14px;
      color: #dfe4ea;
    }

    /* „ÇØ„Ç§„Ç∫„Ç™„Éº„Éê„Éº„É¨„Ç§ */
    #quizOverlay {
      position: fixed;
      inset: 0;
      display: none;
      place-items: center;
      background: rgba(0,0,0,0.7);
      z-index: 100;
      backdrop-filter: blur(4px);
    }
    #quizBox {
      width: min(90vw, 500px);
      background: var(--panel);
      border: 3px solid #5352ed;
      border-radius: 16px;
      padding: 24px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.6);
      animation: slideIn 0.3s ease-out;
    }
    @keyframes slideIn {
      from { transform: translateY(-50px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    #quizTitle {
      font-size: 18px;
      font-weight: 700;
      margin-bottom: 16px;
      color: #ffa502;
    }
    #quizQuestion {
      font-size: 32px;
      font-weight: 700;
      margin: 16px 0 24px;
      color: #f1f2f6;
    }
    .answerGrid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-bottom: 16px;
    }
    .answerBtn {
      padding: 16px;
      font-size: 20px;
      font-weight: 700;
      border-radius: 12px;
      background: #3742fa;
      color: white;
      border: 2px solid #5352ed;
      cursor: pointer;
      transition: all 0.2s;
    }
    .answerBtn:hover {
      background: #5352ed;
      transform: scale(1.05);
    }
    .quizNote {
      font-size: 13px;
      color: #95afc0;
      margin-top: 12px;
    }

    #startScreen {
      position: fixed;
      inset: 0;
      display: grid;
      place-items: center;
      background: rgba(10,14,39,0.95);
      z-index: 50;
      animation: fadeIn 0.5s;
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    .startContent {
      text-align: center;
    }
    .startTitle {
      font-size: 48px;
      font-weight: 700;
      color: #ffa502;
      margin-bottom: 24px;
      text-shadow: 0 0 20px rgba(255,165,2,0.6);
    }
    .startHint {
      font-size: 20px;
      color: #dfe4ea;
      animation: pulse 2s infinite;
    }
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
  </style>
</head>
<body>
  <div id="container">
    <h1>üöÄ „Çπ„Éö„Éº„Çπ„Ç∑„É•„Éº„Çø„Éº Ôºã ÁÆóÊï∞„ÇØ„Ç§„Ç∫ üéØ</h1>
    <canvas id="game" width="500" height="700"></canvas>
    <div class="controls">
      <div id="info">‚Üê ‚Üí ÁßªÂãï / „Çπ„Éö„Éº„ÇπÔºöÂºæÁô∫Â∞Ñ / ÈªÑËâ≤„Ç¢„Ç§„ÉÜ„É†„Åß„ÇØ„Ç§„Ç∫</div>
      <button id="restartBtn">„É™„Çπ„Çø„Éº„Éà</button>
    </div>
  </div>

  <!-- „Çπ„Çø„Éº„ÉàÁîªÈù¢ -->
  <div id="startScreen">
    <div class="startContent">
      <div class="startTitle">SPACE SHOOTER</div>
      <div class="startHint">„Çπ„Éö„Éº„Çπ„Ç≠„Éº„Åß„Çπ„Çø„Éº„Éà</div>
    </div>
  </div>

  <!-- „ÇØ„Ç§„Ç∫„Ç™„Éº„Éê„Éº„É¨„Ç§ -->
  <div id="quizOverlay">
    <div id="quizBox">
      <div id="quizTitle">‚≠ê ÁÆóÊï∞„ÉÅ„É£„É¨„É≥„Ç∏</div>
      <div id="quizQuestion">5 + 7 = ?</div>
      <div class="answerGrid">
        <button class="answerBtn" data-idx="0">10</button>
        <button class="answerBtn" data-idx="1">12</button>
        <button class="answerBtn" data-idx="2">13</button>
        <button class="answerBtn" data-idx="3">15</button>
      </div>
      <div class="quizNote">Ê≠£Ëß£„Åß„Éë„ÉØ„Éº„Ç¢„ÉÉ„ÉóÔºÅ‰∏çÊ≠£Ëß£„Åß„ÇÇÂ§ß‰∏àÂ§´</div>
    </div>
  </div>

  <script>
  (() => {
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    const W = canvas.width;
    const H = canvas.height;

    // ===== „Ç≤„Éº„É†Ë®≠ÂÆö =====
    const CONFIG = {
      player: { w: 40, h: 40, speed: 5 },
      enemy: { w: 35, h: 35, speed: 2, spawnInterval: 800 },
      item: { w: 32, h: 32, speed: 2.5, spawnInterval: 5000 }, // „Çµ„Ç§„Ç∫„Å®ÈÄüÂ∫¶„ÇíË™øÊï¥
      bullet: { w: 6, h: 16, speed: 8 },
      powerupDuration: 8000,
      speedUpInterval: 15,
      speedUpAmount: 0.4
    };

    // ===== „Ç≤„Éº„É†Áä∂ÊÖã =====
    let gameState = {
      player: { x: W/2 - 20, y: H - 100, w: CONFIG.player.w, h: CONFIG.player.h },
      enemies: [],
      items: [],
      bullets: [],
      particles: [],
      score: 0,
      itemsCollected: 0,
      time: 0,
      enemySpeed: CONFIG.enemy.speed,
      level: 1,
      powerupUntil: 0,
      lastEnemySpawn: 0,
      lastItemSpawn: 0,
      started: false,
      running: false,
      gameOver: false,
      inQuiz: false,
      shake: 0,
      keys: { left: false, right: false, space: false },
      spacePressed: false
    };

    // ===== ÂÖ•ÂäõÂá¶ÁêÜ =====
    window.addEventListener('keydown', e => {
      if (e.key === 'ArrowLeft') gameState.keys.left = true;
      if (e.key === 'ArrowRight') gameState.keys.right = true;
      if (e.key === ' ') {
        e.preventDefault();
        if (!gameState.started) {
          startGame();
        } else if (!gameState.spacePressed && !gameState.inQuiz && !gameState.gameOver) {
          shootBullet();
        }
        gameState.keys.space = true;
        gameState.spacePressed = true;
      }
    });

    window.addEventListener('keyup', e => {
      if (e.key === 'ArrowLeft') gameState.keys.left = false;
      if (e.key === 'ArrowRight') gameState.keys.right = false;
      if (e.key === ' ') {
        gameState.keys.space = false;
        gameState.spacePressed = false;
      }
    });

    document.getElementById('restartBtn').addEventListener('click', resetGame);

    // ===== „Ç≤„Éº„É†ÈñãÂßã =====
    function startGame() {
      gameState.started = true;
      gameState.running = true;
      document.getElementById('startScreen').style.display = 'none';
    }

    // ===== „É™„Çª„ÉÉ„Éà =====
    function resetGame() {
      gameState = {
        player: { x: W/2 - 20, y: H - 100, w: CONFIG.player.w, h: CONFIG.player.h },
        enemies: [],
        items: [],
        bullets: [],
        particles: [],
        score: 0,
        itemsCollected: 0,
        time: 0,
        enemySpeed: CONFIG.enemy.speed,
        level: 1,
        powerupUntil: 0,
        lastEnemySpawn: 0,
        lastItemSpawn: 0,
        started: true,
        running: true,
        gameOver: false,
        inQuiz: false,
        shake: 0,
        keys: { left: false, right: false, space: false },
        spacePressed: false
      };
      document.getElementById('startScreen').style.display = 'none';
      closeQuiz();
    }

    // ===== ÂºæÁô∫Â∞Ñ =====
    function shootBullet() {
      const isPowered = Date.now() < gameState.powerupUntil;
      gameState.bullets.push({
        x: gameState.player.x + CONFIG.player.w/2 - CONFIG.bullet.w/2,
        y: gameState.player.y,
        w: CONFIG.bullet.w,
        h: CONFIG.bullet.h
      });
      
      if (isPowered) {
        // „Éë„ÉØ„Éº„Ç¢„ÉÉ„Éó‰∏≠„ÅØ3ÊñπÂêë
        gameState.bullets.push({
          x: gameState.player.x + CONFIG.player.w/2 - CONFIG.bullet.w/2 - 20,
          y: gameState.player.y,
          w: CONFIG.bullet.w,
          h: CONFIG.bullet.h,
          vx: -2
        });
        gameState.bullets.push({
          x: gameState.player.x + CONFIG.player.w/2 - CONFIG.bullet.w/2 + 20,
          y: gameState.player.y,
          w: CONFIG.bullet.w,
          h: CONFIG.bullet.h,
          vx: 2
        });
      }
    }

    // ===== „Çπ„Éù„Éº„É≥ =====
    function spawnEnemy() {
      const x = Math.random() * (W - CONFIG.enemy.w);
      gameState.enemies.push({
        x, y: -CONFIG.enemy.h,
        w: CONFIG.enemy.w,
        h: CONFIG.enemy.h,
        vx: (Math.random() - 0.5) * 2
      });
    }

    function spawnItem() {
      const x = Math.random() * (W - CONFIG.item.w);
      gameState.items.push({
        x, 
        y: -CONFIG.item.h,
        w: CONFIG.item.w,
        h: CONFIG.item.h
      });
    }

    // ===== „Éë„Éº„ÉÜ„Ç£„ÇØ„É´ =====
    function createExplosion(x, y, color, count = 20) {
      for (let i = 0; i < count; i++) {
        const angle = (Math.PI * 2 * i) / count;
        const speed = 2 + Math.random() * 3;
        gameState.particles.push({
          x, y,
          vx: Math.cos(angle) * speed,
          vy: Math.sin(angle) * speed,
          life: 1,
          color,
          size: 3 + Math.random() * 3
        });
      }
      gameState.shake = Math.min(10, gameState.shake + 4);
    }

    // ===== Ë°ùÁ™ÅÂà§ÂÆö =====
    function collides(a, b) {
      return a.x < b.x + b.w &&
             a.x + a.w > b.x &&
             a.y < b.y + b.h &&
             a.y + a.h > b.y;
    }

    // ===== „ÇØ„Ç§„Ç∫ =====
    const quizOverlay = document.getElementById('quizOverlay');
    const quizQuestion = document.getElementById('quizQuestion');
    const answerBtns = Array.from(document.querySelectorAll('.answerBtn'));
    let currentQuiz = null;

    function generateQuiz() {
      const types = ['add', 'subtract', 'multiply'];
      const type = types[Math.floor(Math.random() * types.length)];
      
      let a, b, answer;
      
      if (type === 'add') {
        a = Math.floor(Math.random() * 20) + 1;
        b = Math.floor(Math.random() * 20) + 1;
        answer = a + b;
        quizQuestion.textContent = `${a} + ${b} = ?`;
      } else if (type === 'subtract') {
        a = Math.floor(Math.random() * 30) + 10;
        b = Math.floor(Math.random() * a);
        answer = a - b;
        quizQuestion.textContent = `${a} - ${b} = ?`;
      } else {
        a = Math.floor(Math.random() * 9) + 2;
        b = Math.floor(Math.random() * 9) + 2;
        answer = a * b;
        quizQuestion.textContent = `${a} √ó ${b} = ?`;
      }
      
      const choices = new Set([answer]);
      while (choices.size < 4) {
        const wrong = answer + Math.floor(Math.random() * 10) - 5;
        if (wrong > 0 && wrong !== answer) choices.add(wrong);
      }
      
      const shuffled = Array.from(choices).sort(() => Math.random() - 0.5);
      
      return { answer, choices: shuffled };
    }

    function openQuiz() {
      gameState.inQuiz = true;
      gameState.running = false;
      currentQuiz = generateQuiz();
      
      answerBtns.forEach((btn, idx) => {
        btn.textContent = currentQuiz.choices[idx];
      });
      
      quizOverlay.style.display = 'grid';
    }

    function closeQuiz() {
      quizOverlay.style.display = 'none';
      gameState.inQuiz = false;
      if (!gameState.gameOver) {
        setTimeout(() => gameState.running = true, 100);
      }
    }

    answerBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        if (!currentQuiz) return;
        const idx = Number(btn.dataset.idx);
        const chosen = currentQuiz.choices[idx];
        
        if (chosen === currentQuiz.answer) {
          gameState.score += 100;
          gameState.powerupUntil = Date.now() + CONFIG.powerupDuration;
          createExplosion(gameState.player.x + CONFIG.player.w/2, 
                         gameState.player.y + CONFIG.player.h/2, 
                         '#2ed573', 30);
        } else {
          gameState.score += 20;
        }
        
        closeQuiz();
      });
    });

    // ===== Êõ¥Êñ∞ =====
    function update(dt) {
      if (!gameState.running || gameState.gameOver) return;

      gameState.time += dt;

      // „Éó„É¨„Ç§„É§„ÉºÁßªÂãï
      if (gameState.keys.left) {
        gameState.player.x -= CONFIG.player.speed;
      }
      if (gameState.keys.right) {
        gameState.player.x += CONFIG.player.speed;
      }
      gameState.player.x = Math.max(0, Math.min(W - CONFIG.player.w, gameState.player.x));

      // Èõ£ÊòìÂ∫¶‰∏äÊòá
      const newLevel = Math.floor(gameState.time / 1000 / CONFIG.speedUpInterval) + 1;
      if (newLevel > gameState.level) {
        gameState.level = newLevel;
        gameState.enemySpeed += CONFIG.speedUpAmount;
      }

      // Êïµ„Çπ„Éù„Éº„É≥
      if (gameState.time - gameState.lastEnemySpawn > CONFIG.enemy.spawnInterval) {
        spawnEnemy();
        gameState.lastEnemySpawn = gameState.time;
        
        // Èõ£ÊòìÂ∫¶„Åå‰∏ä„Åå„Çã„Å®ËøΩÂä†„Çπ„Éù„Éº„É≥
        if (Math.random() < gameState.level * 0.1) {
          spawnEnemy();
        }
      }

      // „Ç¢„Ç§„ÉÜ„É†„Çπ„Éù„Éº„É≥
      if (gameState.time - gameState.lastItemSpawn > CONFIG.item.spawnInterval) {
        spawnItem();
        gameState.lastItemSpawn = gameState.time;
      }

      // ÊïµÁßªÂãï
      gameState.enemies.forEach(e => {
        e.y += gameState.enemySpeed;
        e.x += e.vx;
        if (e.x < 0 || e.x > W - e.w) e.vx *= -1;
      });

      // „Ç¢„Ç§„ÉÜ„É†ÁßªÂãï
      gameState.items.forEach(i => {
        i.y += CONFIG.item.speed;
      });

      // ÂºæÁßªÂãï
      gameState.bullets.forEach(b => {
        b.y -= CONFIG.bullet.speed;
        if (b.vx) b.x += b.vx;
      });

      // ÁîªÈù¢Â§ñÂâäÈô§
      gameState.enemies = gameState.enemies.filter(e => e.y < H + e.h);
      gameState.items = gameState.items.filter(i => i.y < H + i.h);
      gameState.bullets = gameState.bullets.filter(b => b.y > -b.h);

      // Âºæ„Å®Êïµ„ÅÆË°ùÁ™Å
      for (let i = gameState.bullets.length - 1; i >= 0; i--) {
        const b = gameState.bullets[i];
        for (let j = gameState.enemies.length - 1; j >= 0; j--) {
          const e = gameState.enemies[j];
          if (collides(b, e)) {
            createExplosion(e.x + e.w/2, e.y + e.h/2, '#ff4757', 15);
            gameState.enemies.splice(j, 1);
            gameState.score += 10;
            gameState.bullets.splice(i, 1);
            break;
          }
        }
      }

      // „Éó„É¨„Ç§„É§„Éº„Å®„Ç¢„Ç§„ÉÜ„É†„ÅÆË°ùÁ™ÅÔºà‰øÆÊ≠£ÁâàÔºâ
      if (!gameState.inQuiz) {
        for (let i = gameState.items.length - 1; i >= 0; i--) {
          const item = gameState.items[i];
          if (collides(gameState.player, item)) {
            gameState.itemsCollected++;
            createExplosion(item.x + item.w/2, item.y + item.h/2, '#ffa502', 20);
            gameState.items.splice(i, 1);
            openQuiz();
            break; // 1„Å§Âèñ„Å£„Åü„Çâ„É´„Éº„Éó„ÇíÊäú„Åë„Çã
          }
        }
      }

      // „Éó„É¨„Ç§„É§„Éº„Å®Êïµ„ÅÆË°ùÁ™Å
      for (const e of gameState.enemies) {
        if (collides(gameState.player, e)) {
          gameState.gameOver = true;
          gameState.running = false;
          createExplosion(gameState.player.x + CONFIG.player.w/2, 
                         gameState.player.y + CONFIG.player.h/2, 
                         '#5352ed', 40);
          break;
        }
      }

      // „Éë„Éº„ÉÜ„Ç£„ÇØ„É´Êõ¥Êñ∞
      gameState.particles = gameState.particles.filter(p => {
        p.x += p.vx;
        p.y += p.vy;
        p.vy += 0.1;
        p.life -= dt / 1000;
        return p.life > 0;
      });

      // ÁîªÈù¢Êè∫„ÇåÊ∏õË°∞
      gameState.shake *= 0.9;
    }

    // ===== ÊèèÁîª =====
    function draw() {
      // ÁîªÈù¢Êè∫„Çå
      const shakeX = (Math.random() - 0.5) * gameState.shake;
      const shakeY = (Math.random() - 0.5) * gameState.shake;
      ctx.setTransform(1, 0, 0, 1, shakeX, shakeY);

      // ËÉåÊôØ
      const grad = ctx.createLinearGradient(0, 0, 0, H);
      grad.addColorStop(0, '#0a0e27');
      grad.addColorStop(1, '#1e2a4a');
      ctx.fillStyle = grad;
      ctx.fillRect(0, 0, W, H);

      // ÊòüÔºàËÉåÊôØË£ÖÈ£æÔºâ
      ctx.fillStyle = 'rgba(255,255,255,0.3)';
      for (let i = 0; i < 50; i++) {
        const x = (i * 37) % W;
        const y = ((i * 53 + gameState.time * 0.01) % H);
        ctx.fillRect(x, y, 2, 2);
      }

      // Êïµ
      gameState.enemies.forEach(e => {
        ctx.fillStyle = '#ff4757';
        ctx.fillRect(e.x, e.y, e.w, e.h);
        ctx.strokeStyle = '#ff6b81';
        ctx.lineWidth = 2;
        ctx.strokeRect(e.x + 2, e.y + 2, e.w - 4, e.h - 4);
      });

      // „Ç¢„Ç§„ÉÜ„É†Ôºà„Çà„ÇäÁõÆÁ´ã„Å§„Çà„ÅÜ„Å´Ôºâ
      gameState.items.forEach(item => {
        const pulse = Math.sin(gameState.time * 0.005) * 0.3 + 0.7;
        
        // „Ç∞„É≠„ÉºÂäπÊûú
        ctx.save();
        ctx.shadowColor = '#ffa502';
        ctx.shadowBlur = 15;
        ctx.fillStyle = `rgba(255, 165, 2, ${pulse})`;
        ctx.fillRect(item.x, item.y, item.w, item.h);
        ctx.restore();
        
        // Â§ñÊû†
        ctx.strokeStyle = '#ffcc00';
        ctx.lineWidth = 3;
        ctx.strokeRect(item.x, item.y, item.w, item.h);
        
        // ‰∏≠ÂøÉ„ÅÆÊòü„Éû„Éº„ÇØ
        ctx.fillStyle = '#fff';
        ctx.font = 'bold 20px system-ui';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.fillText('‚òÖ', item.x + item.w/2, item.y + item.h/2);
      });

      // Âºæ
      ctx.fillStyle = '#2ed573';
      gameState.bullets.forEach(b => {
        ctx.fillRect(b.x, b.y, b.w, b.h);
      });

      // „Éó„É¨„Ç§„É§„Éº
      const isPowered = Date.now() < gameState.powerupUntil;
      if (isPowered) {
        // „Éë„ÉØ„Éº„Ç¢„ÉÉ„Éó„Ç™„Éº„É©
        const pulseSize = Math.sin(gameState.time * 0.01) * 8 + 8;
        ctx.fillStyle = 'rgba(46,213,115,0.3)';
        ctx.fillRect(gameState.player.x - pulseSize/2, 
                     gameState.player.y - pulseSize/2, 
                     CONFIG.player.w + pulseSize, 
                     CONFIG.player.h + pulseSize);
      }
      
      ctx.fillStyle = isPowered ? '#2ed573' : '#5352ed';
      ctx.fillRect(gameState.player.x, gameState.player.y, CONFIG.player.w, CONFIG.player.h);
      
      // „Éó„É¨„Ç§„É§„ÉºË£ÖÈ£æ
      ctx.fillStyle = '#fff';
      ctx.fillRect(gameState.player.x + CONFIG.player.w/2 - 3, gameState.player.y + 5, 6, 10);

      // „Éë„Éº„ÉÜ„Ç£„ÇØ„É´
      gameState.particles.forEach(p => {
        ctx.globalAlpha = p.life;
        ctx.fillStyle = p.color;
        ctx.fillRect(p.x - p.size/2, p.y - p.size/2, p.size, p.size);
      });
      ctx.globalAlpha = 1;

      // UI
      ctx.setTransform(1, 0, 0, 1, 0, 0);
      
      ctx.fillStyle = '#f1f2f6';
      ctx.font = 'bold 18px system-ui';
      ctx.textAlign = 'left';
      ctx.textBaseline = 'top';
      ctx.fillText(`„Çπ„Ç≥„Ç¢: ${gameState.score}`, 16, 30);
      ctx.fillText(`ÊôÇÈñì: ${(gameState.time / 1000).toFixed(1)}s`, 16, 55);
      ctx.fillText(`Lv: ${gameState.level}`, 16, 80);
      
      ctx.textAlign = 'right';
      ctx.fillText(`„Ç¢„Ç§„ÉÜ„É†: ${gameState.itemsCollected}`, W - 16, 30);
      
      if (isPowered) {
        const remaining = Math.ceil((gameState.powerupUntil - Date.now()) / 1000);
        ctx.fillStyle = '#2ed573';
        ctx.fillText(`„Éë„ÉØ„Éº„Ç¢„ÉÉ„Éó: ${remaining}s`, W - 16, 55);
      }
      
      ctx.textAlign = 'left';

      // „Ç≤„Éº„É†„Ç™„Éº„Éê„Éº
      if (gameState.gameOver) {
        ctx.fillStyle = 'rgba(0,0,0,0.7)';
        ctx.fillRect(0, 0, W, H);
        
        ctx.fillStyle = '#fff';
        ctx.font = 'bold 48px system-ui';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.fillText('GAME OVER', W/2, H/2 - 40);
        
        ctx.font = 'bold 24px system-ui';
        ctx.fillStyle = '#ffa502';
        ctx.fillText(`ÊúÄÁµÇ„Çπ„Ç≥„Ç¢: ${gameState.score}`, W/2, H/2 + 10);
        ctx.fillText(`„Ç¢„Ç§„ÉÜ„É†: ${gameState.itemsCollected}ÂÄã`, W/2, H/2 + 45);
        
        ctx.font = '18px system-ui';
        ctx.fillStyle = '#dfe4ea';
        ctx.fillText('„Çπ„Éö„Éº„Çπ„Åæ„Åü„ÅØ„Éú„Çø„É≥„Åß„É™„Çπ„Çø„Éº„Éà', W/2, H/2 + 90);
        
        ctx.textAlign = 'left';
        
        // „Ç≤„Éº„É†„Ç™„Éº„Éê„ÉºÊôÇ„Çπ„Éö„Éº„Çπ„Åß„É™„Çπ„Çø„Éº„Éà
        if (gameState.keys.space && gameState.spacePressed) {
          resetGame();
        }
      }
    }

    // ===== „É°„Ç§„É≥„É´„Éº„Éó =====
    let lastTime = performance.now();
    function loop(now) {
      const dt = now - lastTime;
      lastTime = now;
      
      update(dt);
      draw();
      
      requestAnimationFrame(loop);
    }

    requestAnimationFrame(loop);
  })();
  </script>
</body>
</html>